{"paragraphs":[{"text":"import spark.implicits._\n\nimport org.apache.spark.sql.functions._\n\nimport scala.collection.mutable.WrappedArray\n\nval spark = new org.apache.spark.sql.SQLContext(sc)\n\nval business = spark.read.json(\"/usr/shivraj/yelp_academic_dataset_business.json\")\n\nval b = business.withColumn(\"category\", explode(\n    when(col(\"categories\").isNotNull, col(\"categories\"))\n    .otherwise(array(lit(null).cast(\"string\")))\n    ))\n    \nval user = spark.read.json(\"/usr/shivraj/yelp_academic_dataset_user.json\")\n\nval review = spark.read.json(\"/usr/shivraj/yelp_academic_dataset_review.json\")\n\nb.registerTempTable(\"business\")\nuser.registerTempTable(\"user\")\nreview.registerTempTable(\"review\")\n\nval top_10_reviewers=spark.sql(\"SELECT user_id,review_count FROM user ORDER BY review_count DESC LIMIT 10\")\n\ntop_10_reviewers.registerTempTable(\"top_10_reviewers\")\n\nval userReviewJson=spark.sql(\"SELECT top.user_id,r.business_id,r.stars FROM top_10_reviewers AS top,review AS r WHERE r.user_id=top.user_id\")\n\nuserReviewJson.registerTempTable(\"userReviewJson\")\n\nval q4Final=spark.sql(\"SELECT u.user_id,avg(u.stars),b.category FROM userReviewJson AS u,business AS b where b.business_id=u.business_id GROUP BY u.user_id,b.category ORDER BY user_id,category\")\n\nq4Final.write\n  .option(\"header\", \"true\")\n  .csv(\"/usr/shivraj/q4Spark.csv\")","user":"anonymous","dateUpdated":"2017-03-12T23:40:55+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1489361541078_1172477343","id":"20170312-233221_545159509","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport spark.implicits._\n\nimport org.apache.spark.sql.functions._\n\nimport scala.collection.mutable.WrappedArray\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nspark: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@1b79ce88\n\nbusiness: org.apache.spark.sql.DataFrame = [address: string, attributes: array<string> ... 14 more fields]\n\nb: org.apache.spark.sql.DataFrame = [address: string, attributes: array<string> ... 15 more fields]\n\nuser: org.apache.spark.sql.DataFrame = [average_stars: double, compliment_cool: bigint ... 21 more fields]\n\nreview: org.apache.spark.sql.DataFrame = [business_id: string, cool: bigint ... 8 more fields]\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\ntop_10_reviewers: org.apache.spark.sql.DataFrame = [user_id: string, review_count: bigint]\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nuserReviewJson: org.apache.spark.sql.DataFrame = [user_id: string, business_id: string ... 1 more field]\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n\nq4Final: org.apache.spark.sql.DataFrame = [user_id: string, avg(stars): double ... 1 more field]\n"},"dateCreated":"2017-03-12T23:32:21+0000","dateStarted":"2017-03-12T23:40:55+0000","dateFinished":"2017-03-12T23:41:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5397"},{"text":"","user":"anonymous","dateUpdated":"2017-03-12T23:40:55+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1489362009352_248540871","id":"20170312-234009_1232590174","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2017-03-12T23:40:09+0000","dateStarted":"2017-03-12T23:40:56+0000","dateFinished":"2017-03-12T23:41:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5398"}],"name":"q4","id":"2CD2DKEKF","angularObjects":{"2CAAUKHWB:shared_process":[],"2CC7GR9KR:shared_process":[],"2CBUX3KCQ:shared_process":[],"2CE1XEF5G:shared_process":[],"2CBKW4JUC:shared_process":[],"2CD4QAWFX:shared_process":[],"2CCZ89BJ2:shared_process":[],"2CAB6HT57:shared_process":[],"2CDW55RX1:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}